import pandas as pd
import numpy as np
import yfinance as yf
import matplotlib.pyplot as plt
import statsmodels.api as sm
from statsmodels.tsa.stattools import acf

data = yf.download('SPY', start='2000-01-01', end='2014-01-01')
true_volatility = data['Close'].rolling(window=30).std()
true_volatility = true_volatility.bfill()

fig, ax = plt.subplots(figsize=(12, 6))
sm.graphics.tsa.plot_acf(true_volatility.dropna(), lags=60, ax=ax, title="ACF of Volatility")
plt.show()

log_volatility = np.log(true_volatility)
fig, ax = plt.subplots(figsize=(12, 6))
sm.graphics.tsa.plot_acf(log_volatility.dropna(), lags=60, ax=ax, title="Autocorrelation of Log-Volatility")
plt.show()

volatility_acfs = acf(true_volatility, nlags=60, fft=True)

# Application du logarithme naturel aux valeurs d'autocorrélation (éviter log(0) ou valeurs négatives)
log_volatility_acfs = np.log(np.abs(volatility_acfs) + 1e-10)  # Ajout de 1e-10 pour éviter log(0)

# Tracer l'autocorrélation des valeurs logarithmiques des autocorrélations de la volatilité
fig, ax = plt.subplots(figsize=(12, 6))
plt.plot([k for k in range (0,61)],log_volatility_acfs)
plt.title("Log-Autocorrelation of Volatility ACFs")
plt.show()
